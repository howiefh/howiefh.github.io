title: Maven 总结
date: 2017-09-29 22:06:33
tags: [maven, java]
categories: java
description: maven
published: false
---

# 概览

Apache Maven 是一个项目构建、管理工具。基于项目对象模型（POM）的概念，Maven可以用来管理项目的依赖、编译、文档等信息。

Maven 提倡的是“约定优于配置”，基于这种理念，很多事情会变的简单起来，比如看到 `src/main/java` 你就知道这目录下是 Java 源文件，你也不必为了构建项目过多地配置插件。Maven 中的 Super POM 中指定了项目默认的目录结构、输出目录、常用插件版本配置等，所有的 POM 都会隐式地继承它（Super POM 有点像是 Java 中的 Object）。下面是一个简单的 POM 文件:

```
<project xmlns="http://maven.apache.org/POM/4.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
		http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <!-- POM对象模型版本 -->
  <modelVersion>4.0.0</modelVersion>

  <!-- 项目坐标 -->
  <groupId>io.github.howiefh</groupId>
  <artifactId>demo</artifactId>
  <version>1.0.0-SNAPSHOT</version>
  <packaging>pom</packaging>

  <!-- 项目坐标 -->
  <name>Maven Project</name>
  <url>http://maven.apache.org</url>
  <description>Demo project</description>

  <!-- 项目依赖 -->
  <dependencies>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.8.2</version>
      <scope>test</scope>
    </dependency>
  </dependencies>
</project>
```

<!-- more -->

## 坐标

Maven 坐标定义了一组标识，它们可以用来唯一标识一个项目，一个依赖，或者 Maven POM 里的一个插件。 groupId, artifactId, version 和 packaging 这些组合的标识符拼成了一个项目的坐标。

- groupId
    团体标识的约定是，它以创建这个项目的组织名称的逆向域名(reverse domain name)开头。
- artifactId
    在groupId下的表示一个单独项目的唯一标识符。
- version
    一个项目的特定版本。正在开发中的项目会加一个“SNAPSHOT”的标记。
- packaging
    项目的类型，默认是 jar，还可以是 war，ear。pom 类型比较特殊，涉及到后面提及的继承、聚合两个概念。packaging 是坐标的一部分，但不是项目唯一标识的一部分。

还有一个限定符 classifier （分类器） 用于同样的代码生成多个单独的构件的场景。比如同时生成 JavaDoc 和二进制 JAR 包。

## 聚合和继承

为了能用一条命令就能构建 demo-common 和 demo-dao 两个模块，我们需要建立一个额外的名为 demo-aggregator 的模块，然后通过该模块构建整个项目的所有模块。demo-aggregator本身也是个 Maven 项目，它的 POM 如下

```
<project>
    <modelVersion>4.0.0</modelVersion>
    <groupId>io.github.howiefh</groupId>
    <artifactId>demo-aggregator</artifactId>
    <version>1.0.0-SNAPSHOT</version>
    <packaging>pom</packaging>
    <name>Demo Aggregator</name>
    <modules>
        <module>demo-common</module>
        <module>demo-dao</module>
    </modules>
</project>
```
注意：packaging 的类型为 pom，module 的值是一个以当前 POM 为主目录的相对路径。

如果多个项目中使用很多相同的配置，可以考虑把公共配置放入父 POM， 子项目继承父 POM 实现配置复用.

```
<project>
    <parent>
        <groupId>io.github.howiefh</groupId>
        <artifactId>demo</artifactId>
        <version>1.0.0-SNAPSHOT</version>
        <relativePath>../pom.xml</relativePath> <!-- 仅为了说明用法，有点多余，Maven也会从这里找父POM -->
    </parent>
    <modelVersion>4.0.0</modelVersion>
    <artifactId>demo-common</artifactId>
    <packaging>jar</packaging>
    <name>Demo Common</name>
</project>
```

一个 Maven POM 从它父POM中继承的项目列表：

- 定义符（groupId和artifactId中至少有一个必须被覆盖， 上面的配置中并没写groupId和version，会从父POM继承）
- 依赖
- 开发者和贡献者
- 插件列表项目对象模型
- 报告列表
- 插件执行 （id匹配的执行会被合并）
- 插件配置

Maven 假设父 POM 在本地仓库中可用，或者在当前项目的父目录(../pom.xml) 中可用。 如果两个位置都不可用，默认行为还可以通过relativePath元素被覆盖。

注意：模块并不等于子项目。但是聚合和继承一般会组合使用。

区别：
1. 对于聚合来说，它知道有哪些模块被聚合，但被聚合的模块不知道这个聚合的存在。
2. 对于继承关系的父 POM 来说，它不知道有哪些子项目继承它，但那些子项目都知道自己的父 POM 是什么。

共同点：
1. 聚合 POM 与继承关系中的父 POM 的 packaging 都是 pom
2. 聚合与继承关系中的父模块除了 POM 之外都没有实际的内容。

一般公司会维护一个父 POM，不同的团队的项目都继承这个父 POM 并且一般也会维护一个自己团队的父 POM。继承关系如下

```
Super POM ---被隐式继承---> xxx-company-parent ---被显示继承---> xxx-project-parent
```

## 依赖管理
### 依赖范围

依赖范围控制哪些依赖在哪些classpath（编译classpath、测试classpath、运行classpath）中可用，哪些依赖包含在一个应用中。

- compile（编译范围）
    compile是默认的范围；编译范围依赖在所有的classpath中可用。
- provided（已提供范围）
    provided依赖只有在当JDK或者一个容器已提供该依赖之后才使用。使用此依赖范围的Maven依赖，对于编译和测试classpath有效，但在运行时无效。典型的例子是servlet-api，编译和测试项目的时候需要该依赖，但在运行项目的时候，由于容器已经提供，就不需要Maven重复地引入一遍。
- runtime（运行时范围）
    runtime依赖在运行和测试系统的时候需要，但在编译的时候不需要。比如，你可能在编译的时候只需要JDBC API JAR，而只有在运行的时候才需要JDBC驱动实现。
- test（测试范围）
    test范围依赖在一般的编译和运行时都不需要，它们只有在测试编译和测试运行阶段可用。
- system（系统范围）
    该依赖与三种classpath的关系，和provided依赖范围完全一致。但是，使用system范围依赖时必须通过systemPath元素显式地指定依赖文件的路径。由于此类依赖不是通过Maven仓库解析的，而且往往与本机系统绑定，可能造成构建的不可移植，因此应该谨慎使用。
- import(Maven 2.0.9及以上)
    导入依赖范围。该依赖范围不会对三种classpath产生实际的影响。

scope    | main-classpath | test-classpath | runtime-classpath | example
---      | ---            | ---            | ---               | ---
compile  | Y              | Y              | Y                 | slf4j
test     | -              | Y              | -                 | junit
provided | Y              | Y              | -                 | servlet-api
runtime  | -              | Y              | Y                 | mysql-jdbc-driver

### 依赖传递
### 依赖调解
